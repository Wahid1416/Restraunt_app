{% extends "base_admin.html" %}

{% block title %}Sales Reports{% endblock %}
{% block page_title %}Sales Reports{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-bg-success shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Total Sales</h5>
                <h4 class="card-text">₹{{ "%.2f"|format(total_sales) }}</h4>
            </div>
        </div>
    </div>
</div>
<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h5 class="card-title">Filter Reports</h5>
        <form method="GET" action="{{ url_for('admin.reports') }}">
            <div class="row g-3 align-items-end">
                <div class="col-md-2">
                    <label for="from_date" class="form-label">From Date</label>
                    <input type="date" class="form-control" id="from_date" name="from_date" value="{{ from_date }}">
                </div>
                <div class="col-md-2">
                    <label for="from_time" class="form-label">From Time</label>
                    <input type="time" class="form-control" id="from_time" name="from_time" value="{{ from_time }}">
                </div>
                <div class="col-md-2">
                    <label for="to_date" class="form-label">To Date</label>
                    <input type="date" class="form-control" id="to_date" name="to_date" value="{{ to_date }}">
                </div>
                <div class="col-md-2">
                    <label for="to_time" class="form-label">To Time</label>
                    <input type="time" class="form-control" id="to_time" name="to_time" value="{{ to_time }}">
                </div>
                <div class="col-md-2">
                    <label for="order_id" class="form-label">Order ID</label>
                    <input type="text" class="form-control" id="order_id" name="order_id" value="{{ order_id }}">
                </div>
                <div class="col-md-2">
                    <label for="payment_type" class="form-label">Payment Type</label>
                    <select id="payment_type" name="payment_type" class="form-select">
                        <option value="">All</option>
                        {% for method in payment_methods %}
                        <option value="{{ method }}" {% if method == payment_type %}selected{% endif %}>{{ method }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="item_name" class="form-label">Item Name</label>
                    <input type="text" class="form-control" id="item_name" name="item_name" value="{{ item_name }}">
                </div>
                <div class="col-md-1 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Filter</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
        <h5>All Completed Orders</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Item</th>
                        <th>Type</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Payment Type</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in all_orders %}
                    <tr>
                        <td>{{ order.Order_id }}</td>
                        <td>{{ order.item }}</td>
                        <td>{{ order.type }}</td>
                        <td>{{ order.Quantity }}</td>
                        <td>₹{{ order.price }}</td>
                        <td>{{ datetime.fromisoformat(order['date_time']).strftime('%Y-%m-%d') }}</td>
                        <td>{{ datetime.fromisoformat(order['date_time']).strftime('%H:%M:%S') }}</td>
                        <td>{{ order.payment_type }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}